{% extends "base.html" %}
{% block title %}添加群发任务{% endblock %}

{% block main %}
<h1 class="h3 pt-4 mb-3 font-weight-normal">添加群发任务</h1>
<table class="table">
  <tbody>
    <tr>
        <td>标题</td><td>{{ template.title|e }}</td>
    </tr><tr>
        <td>行业</td><td>{{ template.industry|e }}</td>
    </tr><tr>
        <td>详细内容</td><td>{{ template.content|nl2br|safe }}</td>
    </tr><tr>
        <td>内容示例</td><td id="example" data-content="{{template.content|nl2br|safe}}"></td>
    </tr>
  </tbody>
</table>

<form method="post" acthon="#">
    <div class="form-group row">
        {% for key in keys %}
        <label for="{{ key }}" class="col-sm-1 col-form-label mb-1">{{ key }}</label>
        <div class="col-sm-11">
            <input type="text" name="{{ key }}"
                   class="form-control" id="{{ key }}"
                   placeholder="请输入{{ key }}内容..."
            {% if data %}value="{{ data[key]['value'] }}"{% endif %}>
        </div>
        {% endfor %}
    </div>
    <button class="btn btn-primary btn-lg" type="submit">提交群发任务</button>
</form>
<script>
    function example() {
        $('#example').html(
            $('#example').attr('data-content')
            {% for key in keys %}
            .replace('{{ '{{' }}{{ key }}.DATA{{ '}}' }}', $('#{{ key }}').val())
            {% endfor %}
        );
    }
    example();
    $('input').keyup(example);
</script>
{% endblock %}
